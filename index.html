<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Code Editor</title>
    <link rel="stylesheet" href="style.css">

    <!-- CodeMirror CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/dracula.min.css">
</head>
<body>
    <!-- Header -->
    <header>
        <h1>Live Code Editor</h1>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Editor Container -->
        <div class="editor-container">
            <!-- Tabs for switching between HTML, CSS, and JavaScript -->
            <div class="tabs">
                <button class="tab-button active" data-tab="html">HTML</button>
                <button class="tab-button" data-tab="css">CSS</button>
                <button class="tab-button" data-tab="js">JavaScript</button>
            </div>

            <!-- HTML Editor -->
            <textarea id="html-editor" class="code-editor active"></textarea>

            <!-- CSS Editor -->
            <textarea id="css-editor" class="code-editor"></textarea>

            <!-- JavaScript Editor -->
            <textarea id="js-editor" class="code-editor"></textarea>
        </div>

        <!-- Preview Container -->
        <div class="preview-container">
            <div class="preview-header">
                <button id="popoutBtn" class="popout-btn">Popout Preview</button>
            </div>
            <iframe id="preview" class="preview"></iframe>
        </div>
    </div>

    <!-- CodeMirror Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/htmlmixed/htmlmixed.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>

    <!-- Main Script -->
    <script>
        // Initialize CodeMirror editors
        const htmlEditor = CodeMirror.fromTextArea(document.getElementById("html-editor"), {
            mode: "htmlmixed",
            theme: "dracula",
            lineNumbers: true,
            tabSize: 2
        });
        const cssEditor = CodeMirror.fromTextArea(document.getElementById("css-editor"), {
            mode: "css",
            theme: "dracula",
            lineNumbers: true,
            tabSize: 2
        });
        const jsEditor = CodeMirror.fromTextArea(document.getElementById("js-editor"), {
            mode: "javascript",
            theme: "dracula",
            lineNumbers: true,
            tabSize: 2
        });

        // Function to update preview
        function updatePreview() {
            const htmlContent = htmlEditor.getValue();
            const cssContent = `<style>${cssEditor.getValue()}</style>`;
            const jsContent = `<script>${jsEditor.getValue()}<\/script>`;
            const fullContent = `${htmlContent}${cssContent}${jsContent}`;

            const previewFrame = document.getElementById('preview');
            previewFrame.srcdoc = fullContent;
        }

        // Listen for changes in the editors to update preview dynamically
        htmlEditor.on("change", updatePreview);
        cssEditor.on("change", updatePreview);
        jsEditor.on("change", updatePreview);

        // Save content to localStorage
        function saveContentToLocalStorage() {
            localStorage.setItem("htmlContent", htmlEditor.getValue());
            localStorage.setItem("cssContent", cssEditor.getValue());
            localStorage.setItem("jsContent", jsEditor.getValue());
        }

        // Load saved content if available
        function loadContentFromLocalStorage() {
            const savedHtml = localStorage.getItem("htmlContent");
            const savedCss = localStorage.getItem("cssContent");
            const savedJs = localStorage.getItem("jsContent");

            if (savedHtml) htmlEditor.setValue(savedHtml);
            if (savedCss) cssEditor.setValue(savedCss);
            if (savedJs) jsEditor.setValue(savedJs);

            updatePreview();
        }

        // Load saved content on page load
        window.addEventListener("load", loadContentFromLocalStorage);

        // Popout preview button functionality
        document.getElementById("popoutBtn").addEventListener("click", () => {
            const htmlContent = htmlEditor.getValue();
            const cssContent = `<style>${cssEditor.getValue()}</style>`;
            const jsContent = `<script>${jsEditor.getValue()}<\/script>`;
            const fullContent = `
                <html>
                <head><meta charset="UTF-8"><title>Live Preview</title></head>
                <body>${htmlContent}${cssContent}${jsContent}</body>
                </html>
            `;

            const previewBlob = new Blob([fullContent], { type: 'text/html' });
            const previewUrl = URL.createObjectURL(previewBlob);

            const popoutWindow = window.open(previewUrl, '_blank');
            if (!popoutWindow) {
                alert("Please allow pop-ups to open the preview.");
            }
        });

        // Tab switching logic
        const tabButtons = document.querySelectorAll(".tab-button");
        const codeEditors = document.querySelectorAll(".code-editor");

        tabButtons.forEach(button => {
            button.addEventListener("click", () => {
                tabButtons.forEach(btn => btn.classList.remove("active"));
                codeEditors.forEach(editor => editor.classList.remove("active"));

                button.classList.add("active");
                document.getElementById(button.getAttribute("data-tab") + "-editor").parentElement.classList.add("active");
            });
        });
    </script>
</body>
</html>
